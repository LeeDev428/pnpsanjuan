{% extends "employee/base.html" %}

{% block title %}My Profile{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
{% endblock %}

{% block content %}
<div class="profile-header">
    <h1>PROFILE</h1>
</div>

<form method="POST" enctype="multipart/form-data" class="profile-form" id="profileForm">
    <div class="profile-grid">
        <!-- Left Column: Profile Picture -->
        <div class="profile-picture-section">
            <div class="profile-picture">
                {% if profile and profile.profile_picture %}
                    <img src="{{ url_for('static', filename=profile.profile_picture) }}" alt="Profile Picture" class="avatar-circle">
                {% else %}
                    <div class="avatar-circle"></div>
                {% endif %}
            </div>
            <div class="profile-name">
                <p><strong>Name:</strong> {{ profile.first_name or '' }} {{ profile.middle_name or '' }} {{ profile.last_name or '' }}</p>
                <p><strong>Rank:</strong> {{ profile.rank or 'N/A' }}</p>
            </div>
            <div class="form-group" id="pictureUploadGroup" style="display: none;">
                <label for="profile_picture">Change Profile Picture</label>
                <input type="file" id="profile_picture" name="profile_picture" accept="image/*">
                <small>Allowed: PNG, JPG, JPEG, GIF (Max 16MB)</small>
            </div>
        </div>

        <!-- Right Column: General Information -->
        <div class="profile-info-section">
            <h2>I. General Information</h2>
            <div class="form-grid-2col">
             <div class="info-row full-width">
                    <label>First Name</label>
                    <div class="info-value" id="first_name_view">{{ profile.first_name or 'N/A' }}</div>
                    <input type="text" id="first_name" name="first_name" value="{{ profile.first_name or '' }}" style="display: none;">
                </div>
         
                
             <div class="info-row full-width">
                    <label>Middle Name</label>
                    <div class="info-value" id="middle_name_view">{{ profile.middle_name or 'N/A' }}</div>
                    <input type="text" id="middle_name" name="middle_name" value="{{ profile.middle_name or '' }}" style="display: none;">
                </div>

                   <div class="info-row full-width">
                    <label>Last Name</label>
                    <div class="info-value" id="last_name_view">{{ profile.last_name or 'N/A' }}</div>
                    <input type="text" id="last_name" name="last_name" value="{{ profile.last_name or '' }}" style="display: none;">
                </div>
                
                    <div class="info-row full-width">
                    <label>Unit</label>
                    <div class="info-value" id="unit_view">{{ profile.unit or 'N/A' }}</div>
                    <input type="text" id="unit" name="unit" value="{{ profile.unit or '' }}" style="display: none;">
                </div>
             <div class="info-row full-width">
                    <label>Station</label>
                    <div class="info-value" id="station_view">{{ profile.station or 'N/A' }}</div>
                    <input type="text" id="station" name="station" value="{{ profile.station or '' }}" style="display: none;">
                </div>
                
          
             <div class="info-row full-width">
                    <label>Address</label>
                    <div class="info-value" id="address_view">{{ profile.address or 'N/A' }}</div>
                    <input type="text" id="address" name="address" value="{{ profile.address or '' }}" style="display: none;">
                </div>
                
             <div class="info-row full-width">
                    <label>Suffix</label>
                    <div class="info-value" id="suffix_view">{{ profile.suffix or 'N/A' }}</div>
                    <input type="text" id="suffix" name="suffix" value="{{ profile.suffix or '' }}" style="display: none;">
                </div>
             <div class="info-row full-width">
                    <label>Rank</label>
                    <div class="info-value" id="rank_view">{{ profile.rank or 'N/A' }}</div>
                    <input type="text" id="rank" name="rank" value="{{ profile.rank or '' }}" style="display: none;">
                </div>
                
                <div class="info-row full-width">
                    <label>Home Address</label>
                    <div class="info-value" id="home_address_view">{{ profile.home_address or 'N/A' }}</div>
                    <input type="text" id="home_address" name="home_address" value="{{ profile.home_address or '' }}" style="display: none;">
                </div>
                
                <div class="info-row full-width">
                    <label>Email</label>
                    <div class="info-value">{{ user.email }}</div>
                    <input type="email" id="email" name="email" value="{{ user.email }}" readonly style="display: none;">
                </div>
                
             <div class="info-row full-width">
                    <label>Gender</label>
                    <div class="info-value" id="gender_view">{{ profile.gender or 'N/A' }}</div>
                    <select id="gender" name="gender" style="display: none;">
                        <option value="">Select</option>
                        <option value="Male" {% if profile.gender == 'Male' %}selected{% endif %}>Male</option>
                        <option value="Female" {% if profile.gender == 'Female' %}selected{% endif %}>Female</option>
                        <option value="Other" {% if profile.gender == 'Other' %}selected{% endif %}>Other</option>
                    </select>
                </div>
             <div class="info-row full-width">
                    <label>Date of Birth</label>
                    <div class="info-value" id="date_of_birth_view">{{ profile.date_of_birth or 'N/A' }}</div>
                    <input type="date" id="date_of_birth" name="date_of_birth" value="{{ profile.date_of_birth or '' }}" style="display: none;">
                </div>
                
             <div class="info-row full-width">
                    <label>Place of Birth</label>
                    <div class="info-value" id="place_of_birth_view">{{ profile.place_of_birth or 'N/A' }}</div>
                    <input type="text" id="place_of_birth" name="place_of_birth" value="{{ profile.place_of_birth or '' }}" style="display: none;">
                </div>
             <div class="info-row full-width">
                    <label>Religion</label>
                    <div class="info-value" id="religion_view">{{ profile.religion or 'N/A' }}</div>
                    <input type="text" id="religion" name="religion" value="{{ profile.religion or '' }}" style="display: none;">
                </div>
            </div>

            <h3>Emergency Contact:</h3>
            <div class="form-grid-2col">
             <div class="info-row full-width">
                    <label>Name:</label>
                    <div class="info-value" id="emergency_contact_name_view">{{ profile.emergency_contact_name or 'N/A' }}</div>
                    <input type="text" id="emergency_contact_name" name="emergency_contact_name" value="{{ profile.emergency_contact_name or '' }}" style="display: none;">
                </div>
             <div class="info-row full-width">
                    <label>Relationship:</label>
                    <div class="info-value" id="emergency_relationship_view">{{ profile.emergency_relationship or 'N/A' }}</div>
                    <input type="text" id="emergency_relationship" name="emergency_relationship" value="{{ profile.emergency_relationship or '' }}" style="display: none;">
                </div>
                <div class="info-row full-width">
                    <label>Contact #:</label>
                    <div class="info-value" id="emergency_contact_number_view">{{ profile.emergency_contact_number or 'N/A' }}</div>
                    <input type="text" id="emergency_contact_number" name="emergency_contact_number" value="{{ profile.emergency_contact_number or '' }}" style="display: none;">
                </div>
            </div>
        </div>
    </div>

    <!-- Educational Background Section -->
    <div class="section-box">
        <h2>II. Educational Background</h2>
        <p class="section-note">Add your educational details here (Coming soon)</p>
    </div>

    <!-- Schooling Records Section -->
    <div class="section-box">
        <h2>III. Schooling Records</h2>
        <p class="section-note">Add your schooling records here (Coming soon)</p>
    </div>

    <!-- Training Records Section -->
    <div class="section-box">
        <h2>IV. Training Records</h2>
        <p class="section-note">Add your training records here (Coming soon)</p>
    </div>

    <div class="form-actions">
        <button type="button" id="editBtn" class="btn btn-primary btn-large">
            <i class="fas fa-edit"></i> Edit Profile
        </button>
        <button type="submit" id="saveBtn" class="btn btn-primary btn-large" style="display: none;">
            <i class="fas fa-save"></i> Save Changes
        </button>
        <button type="button" id="cancelBtn" class="btn btn-outline btn-large" style="display: none;">
            <i class="fas fa-times"></i> Cancel
        </button>
        <a href="{{ url_for('employee.dashboard') }}" class="btn btn-outline btn-large" id="backBtn">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
    </div>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const editBtn = document.getElementById('editBtn');
    const saveBtn = document.getElementById('saveBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const backBtn = document.getElementById('backBtn');
    const pictureUploadGroup = document.getElementById('pictureUploadGroup');
    const form = document.getElementById('profileForm');
    
    const fields = [
        'first_name', 'unit', 'middle_name', 'station', 'last_name', 'address',
        'suffix', 'rank', 'home_address', 'gender', 'date_of_birth',
        'place_of_birth', 'religion', 'emergency_contact_name',
        'emergency_relationship', 'emergency_contact_number'
    ];
    
    let originalValues = {};

    editBtn.addEventListener('click', function() {
        // Save original values
        fields.forEach(field => {
            const input = document.getElementById(field);
            if (input) {
                originalValues[field] = input.value;
            }
        });

        // Switch to edit mode
        fields.forEach(field => {
            const viewElem = document.getElementById(field + '_view');
            const inputElem = document.getElementById(field);
            
            if (viewElem && inputElem && field !== 'email') {
                viewElem.style.display = 'none';
                inputElem.style.display = 'block';
            }
        });

        // Show/hide buttons
        editBtn.style.display = 'none';
        backBtn.style.display = 'none';
        saveBtn.style.display = 'inline-block';
        cancelBtn.style.display = 'inline-block';
        pictureUploadGroup.style.display = 'block';
    });

    cancelBtn.addEventListener('click', function() {
        // Restore original values
        fields.forEach(field => {
            const inputElem = document.getElementById(field);
            if (inputElem && originalValues[field] !== undefined) {
                inputElem.value = originalValues[field];
            }
        });

        // Reset file input
        document.getElementById('profile_picture').value = '';

        // Switch back to view mode
        fields.forEach(field => {
            const viewElem = document.getElementById(field + '_view');
            const inputElem = document.getElementById(field);
            
            if (viewElem && inputElem) {
                viewElem.style.display = 'block';
                inputElem.style.display = 'none';
            }
        });

        // Show/hide buttons
        editBtn.style.display = 'inline-block';
        backBtn.style.display = 'inline-block';
        saveBtn.style.display = 'none';
        cancelBtn.style.display = 'none';
        pictureUploadGroup.style.display = 'none';
    });
});
</script>
{% endblock %}
